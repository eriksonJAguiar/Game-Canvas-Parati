<html>

<head>
    
</head>

<body>

<input id='animateButton' type='button' value='Animate'/>

<canvas id="bgCanvas" width="1000" height="440">You need to a newer browser to see this awesomeness!</canvas>



<script type="text/javascript">
    
    if (!window.requestNextAnimationFrame) {
    window.requestNextAnimationFrame = (function() {
        return window.webkitRequestAnimationFrame ||
               window.mozRequestAnimationFrame    ||
               window.oRequestAnimationFrame      ||
               window.msRequestAnimationFrame     ||
        function(callback, element) {
            window.setTimeout(callback, 1000 / 60);
        };
    })();
}


(function(win, d) {

    var canvas = d.getElementById('bgCanvas'),
        ctx = canvas.getContext('2d'),
        animateButton = d.getElementById('animateButton'),

        tree = new Image(),
        nearTree = new Image(),
        cloud = new Image(),
        grass = new Image(),
        grass2 = new Image(),
        sky = new Image(),

        paused = true,
        lastTime = 0,
        fps = 60,
        lastFpsUpdate = {
            time: 0,
            value: 0
        },

        skyOffset = 0,
        grassOffset = 0,
        treeOffset = 0,
        nearTreeOffset = 0,
        cloudOffset = 0,

        TREE_VELOCITY = 20,
        FAST_TREE_VELOCITY = 40,
        SKY_VELOCITY = 8,
        GRASS_VELOCITY = 75;


    // Functions.....................................................

    function erase() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function draw() {

        ctx.save();
            skyOffset = skyOffset < canvas.width ? skyOffset + SKY_VELOCITY / fps : 0;
            grassOffset = grassOffset < canvas.width ? grassOffset + GRASS_VELOCITY / fps : 0;
            treeOffset = treeOffset < canvas.width ? treeOffset + TREE_VELOCITY / fps : 0;
            nearTreeOffset = nearTreeOffset < canvas.width ? nearTreeOffset + FAST_TREE_VELOCITY / fps : 0;

            cloudOffset = cloudOffset < canvas.width ? cloudOffset + FAST_TREE_VELOCITY / fps : 0;


            // sky
            ctx.save();
                ctx.translate(-skyOffset, 0);
                    ctx.drawImage(sky, 0, 0);
                    ctx.drawImage(sky, sky.width - 2, 0);
            ctx.restore();

            ctx.save();
                ctx.translate(-cloudOffset,0);
                ctx.drawImage(cloud, 0, 0);
                ctx.drawImage(cloud, cloud.width - 2, 0);
            ctx.restore();

            // small tree
            ctx.save();
                ctx.translate(-treeOffset, 0);
                    ctx.drawImage(tree, 100, 240);
                    ctx.drawImage(tree, 1100, 240);
                    ctx.drawImage(tree, 400, 240);
                    ctx.drawImage(tree, 1400, 240);
                    ctx.drawImage(tree, 700, 240);
                    ctx.drawImage(tree, 1700, 240);
            ctx.restore();

            // nearTree
            ctx.save();
                ctx.translate(-nearTreeOffset, 0);
                    ctx.drawImage(nearTree, 250, 220);
                    ctx.drawImage(nearTree, 1250, 220);
                    ctx.drawImage(nearTree, 800, 220);
                    ctx.drawImage(nearTree, 1800, 220);
            ctx.restore();

            // Grass
            ctx.save();
                ctx.translate(-grassOffset, 0);
                    ctx.drawImage(grass, 0, canvas.height - grass.height);
                    ctx.drawImage(grass, grass.width - 5, canvas.height - grass.height);
                    ctx.drawImage(grass2, 0, canvas.height - grass2.height);
                    ctx.drawImage(grass2, grass2.width, canvas.height - grass2.height);
            ctx.restore();
        ctx.restore();
    }

    function calculateFps(now) {
        var fps = 1000 / (now - lastTime);
        lastTime = now;
        
        return fps;
    }

    function animate(now) {
        if (now === undefined){
            now = +new Date;
        }

        fps = calculateFps(now);

        if (! paused) {
            erase();
            draw();
        }

        requestNextAnimationFrame(animate);
    }

    // Event handlers................................................
    animateButton.onclick = function(e) {
        paused = paused ? false : true;
        if (paused) {
            animateButton.value = 'Animate';
        } else {
            animateButton.value = 'Pause';
        }
    };

    // Initialization................................................
    //tree.src = 'http://anti-code.com/imgs/smalltree.png';
    //nearTree.src = 'http://anti-code.com/imgs/tree-twotrunks.png';

    //smCloud.src = 'Nuvens.png';
    //medCloud.src = 'http://anti-code.com/imgs/cloud-med.png';
    //bigCloud.src = 'http://anti-code.com/imgs/cloud-big.png';
    //cloud.src = 'Nuvens.png';
    grass.src = 'http://anti-code.com/imgs/grass.png';
    grass2.src = 'http://anti-code.com/imgs/grass2.png';
    
    sky.src = 'Fundo.png';

    sky.onload = function(e) {
        draw();
    };

    requestNextAnimationFrame(animate);

})(window, document);

</script>

</body>

</html>